import jsPDF from 'jspdf';
import html2canvas from 'html2canvas';
import QRCode from 'qrcode';

// Language translations
const translations = {
  en: {
    title: 'Muslim Finance Tracker',
    subtitle: 'Personal Finance Report',
    name: 'Name',
    email: 'Email',
    reportDate: 'Report Date',
    time: 'Time',
    financialSummary: 'Financial Summary',
    category: 'Category',
    amount: 'Amount (BDT)',
    totalIncome: 'Total Income',
    totalExpense: 'Total Expense',
    currentBalance: 'Current Balance',
    monthlyIncome: 'Monthly Income',
    monthlyExpense: 'Monthly Expense',
    monthlySavings: 'Monthly Savings',
    transactionHistory: 'Transaction History (Recent 15)',
    date: 'Date',
    type: 'Type',
    income: 'Income',
    expense: 'Expense',
    description: 'Description',
    loanDetails: 'Loan Details',
    loanType: 'Type',
    person: 'Person',
    remaining: 'Remaining',
    status: 'Status',
    given: 'Given',
    taken: 'Taken',
    paid: 'Paid',
    partial: 'Partial',
    pending: 'Pending',
    scanQR: 'Scan QR Code',
    visitWebsite: 'Visit Website',
    generatedBy: 'Generated by Muslim Finance Tracker',
    generatedOn: 'Generated on',
    copyright: 'Â© 2024 Muslim Programmer',
    rights: 'All Rights Reserved',
    website: 'muslim-finance-tracker.vercel.app'
  },
  bn: {
    title: 'à¦®à§à¦¸à¦²à¦¿à¦® à¦«à¦¾à¦‡à¦¨à§à¦¯à¦¾à¦¨à§à¦¸ à¦Ÿà§à¦°à§à¦¯à¦¾à¦•à¦¾à¦°',
    subtitle: 'à¦¬à§à¦¯à¦•à§à¦¤à¦¿à¦—à¦¤ à¦†à¦°à§à¦¥à¦¿à¦• à¦ªà§à¦°à¦¤à¦¿à¦¬à§‡à¦¦à¦¨',
    name: 'à¦¨à¦¾à¦®',
    email: 'à¦‡à¦®à§‡à¦‡à¦²',
    reportDate: 'à¦°à¦¿à¦ªà§‹à¦°à§à¦Ÿ à¦¤à¦¾à¦°à¦¿à¦–',
    time: 'à¦¸à¦®à¦¯à¦¼',
    financialSummary: 'à¦†à¦°à§à¦¥à¦¿à¦• à¦¸à¦¾à¦°à¦¸à¦‚à¦•à§à¦·à§‡à¦ª',
    category: 'à¦¬à¦¿à¦·à¦¯à¦¼',
    amount: 'à¦ªà¦°à¦¿à¦®à¦¾à¦£ (à§³)',
    totalIncome: 'à¦®à§‹à¦Ÿ à¦†à¦¯à¦¼',
    totalExpense: 'à¦®à§‹à¦Ÿ à¦–à¦°à¦š',
    currentBalance: 'à¦¬à¦°à§à¦¤à¦®à¦¾à¦¨ à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸',
    monthlyIncome: 'à¦®à¦¾à¦¸à¦¿à¦• à¦†à¦¯à¦¼',
    monthlyExpense: 'à¦®à¦¾à¦¸à¦¿à¦• à¦–à¦°à¦š',
    monthlySavings: 'à¦®à¦¾à¦¸à¦¿à¦• à¦¸à¦žà§à¦šà¦¯à¦¼',
    transactionHistory: 'à¦²à§‡à¦¨à¦¦à§‡à¦¨à§‡à¦° à¦‡à¦¤à¦¿à¦¹à¦¾à¦¸ (à¦¸à¦°à§à¦¬à¦¶à§‡à¦· à§§à§«à¦Ÿà¦¿)',
    date: 'à¦¤à¦¾à¦°à¦¿à¦–',
    type: 'à¦§à¦°à¦¨',
    income: 'à¦†à¦¯à¦¼',
    expense: 'à¦–à¦°à¦š',
    description: 'à¦¬à¦¿à¦¬à¦°à¦£',
    loanDetails: 'à¦‹à¦£à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£',
    loanType: 'à¦§à¦°à¦¨',
    person: 'à¦¬à§à¦¯à¦•à§à¦¤à¦¿',
    remaining: 'à¦¬à¦¾à¦•à¦¿',
    status: 'à¦¸à§à¦Ÿà§à¦¯à¦¾à¦Ÿà¦¾à¦¸',
    given: 'à¦¦à§‡à¦“à¦¯à¦¼à¦¾',
    taken: 'à¦¨à§‡à¦“à¦¯à¦¼à¦¾',
    paid: 'à¦ªà¦°à¦¿à¦¶à§‹à¦§à¦¿à¦¤',
    partial: 'à¦†à¦‚à¦¶à¦¿à¦•',
    pending: 'à¦¬à¦•à§‡à¦¯à¦¼à¦¾',
    scanQR: 'QR à¦•à§‹à¦¡ à¦¸à§à¦•à§à¦¯à¦¾à¦¨ à¦•à¦°à§à¦¨',
    visitWebsite: 'à¦“à¦¯à¦¼à§‡à¦¬à¦¸à¦¾à¦‡à¦Ÿ à¦­à¦¿à¦œà¦¿à¦Ÿ à¦•à¦°à§à¦¨',
    generatedBy: 'à¦®à§à¦¸à¦²à¦¿à¦® à¦«à¦¾à¦‡à¦¨à§à¦¯à¦¾à¦¨à§à¦¸ à¦Ÿà§à¦°à§à¦¯à¦¾à¦•à¦¾à¦° à¦¦à§à¦¬à¦¾à¦°à¦¾ à¦¤à§ˆà¦°à¦¿',
    generatedOn: 'à¦¤à§ˆà¦°à¦¿à¦° à¦¤à¦¾à¦°à¦¿à¦– à¦“ à¦¸à¦®à¦¯à¦¼',
    copyright: 'Â© à§¨à§¦à§¨à§ª à¦®à§à¦¸à¦²à¦¿à¦® à¦ªà§à¦°à§‹à¦—à§à¦°à¦¾à¦®à¦¾à¦°',
    rights: 'à¦¸à¦°à§à¦¬à¦¸à§à¦¬à¦¤à§à¦¬ à¦¸à¦‚à¦°à¦•à§à¦·à¦¿à¦¤',
    website: 'muslim-finance-tracker.vercel.app'
  },
  ar: {
    title: 'Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©',
    subtitle: 'ØªÙ‚Ø±ÙŠØ± Ù…Ø§Ù„ÙŠ Ø´Ø®ØµÙŠ',
    name: 'Ø§Ù„Ø§Ø³Ù…',
    email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
    reportDate: 'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±',
    time: 'Ø§Ù„ÙˆÙ‚Øª',
    financialSummary: 'Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ',
    category: 'Ø§Ù„ÙØ¦Ø©',
    amount: 'Ø§Ù„Ù…Ø¨Ù„Øº (BDT)',
    totalIncome: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„',
    totalExpense: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª',
    currentBalance: 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ',
    monthlyIncome: 'Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø´Ù‡Ø±ÙŠ',
    monthlyExpense: 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©',
    monthlySavings: 'Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ',
    transactionHistory: 'Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ø¢Ø®Ø± 15)',
    date: 'Ø§Ù„ØªØ§Ø±ÙŠØ®',
    type: 'Ø§Ù„Ù†ÙˆØ¹',
    income: 'Ø¯Ø®Ù„',
    expense: 'Ù…ØµØ±ÙˆÙ',
    description: 'Ø§Ù„ÙˆØµÙ',
    loanDetails: 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø±ÙˆØ¶',
    loanType: 'Ø§Ù„Ù†ÙˆØ¹',
    person: 'Ø§Ù„Ø´Ø®Øµ',
    remaining: 'Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ',
    status: 'Ø§Ù„Ø­Ø§Ù„Ø©',
    given: 'Ù…Ø¹Ø·Ù‰',
    taken: 'Ù…Ø£Ø®ÙˆØ°',
    paid: 'Ù…Ø¯ÙÙˆØ¹',
    partial: 'Ø¬Ø²Ø¦ÙŠ',
    pending: 'Ù…Ø¹Ù„Ù‚',
    scanQR: 'Ø§Ù…Ø³Ø­ QR',
    visitWebsite: 'Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹',
    generatedBy: 'ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©',
    generatedOn: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡',
    copyright: 'Â© 2024 Muslim Programmer',
    rights: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©',
    website: 'muslim-finance-tracker.vercel.app'
  },
  hi: {
    title: 'à¤®à¥à¤¸à¥à¤²à¤¿à¤® à¤«à¤¾à¤‡à¤¨à¥‡à¤‚à¤¸ à¤Ÿà¥à¤°à¥ˆà¤•à¤°',
    subtitle: 'à¤µà¥à¤¯à¤•à¥à¤¤à¤¿à¤—à¤¤ à¤µà¤¿à¤¤à¥à¤¤ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ',
    name: 'à¤¨à¤¾à¤®',
    email: 'à¤ˆà¤®à¥‡à¤²',
    reportDate: 'à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤¤à¤¿à¤¥à¤¿',
    time: 'à¤¸à¤®à¤¯',
    financialSummary: 'à¤µà¤¿à¤¤à¥à¤¤à¥€à¤¯ à¤¸à¤¾à¤°à¤¾à¤‚à¤¶',
    category: 'à¤¶à¥à¤°à¥‡à¤£à¥€',
    amount: 'à¤°à¤¾à¤¶à¤¿ (BDT)',
    totalIncome: 'à¤•à¥à¤² à¤†à¤¯',
    totalExpense: 'à¤•à¥à¤² à¤µà¥à¤¯à¤¯',
    currentBalance: 'à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤¬à¥ˆà¤²à¥‡à¤‚à¤¸',
    monthlyIncome: 'à¤®à¤¾à¤¸à¤¿à¤• à¤†à¤¯',
    monthlyExpense: 'à¤®à¤¾à¤¸à¤¿à¤• à¤µà¥à¤¯à¤¯',
    monthlySavings: 'à¤®à¤¾à¤¸à¤¿à¤• à¤¬à¤šà¤¤',
    transactionHistory: 'à¤²à¥‡à¤¨-à¤¦à¥‡à¤¨ à¤‡à¤¤à¤¿à¤¹à¤¾à¤¸ (à¤¹à¤¾à¤² à¤•à¥‡ 15)',
    date: 'à¤¤à¤¾à¤°à¥€à¤–',
    type: 'à¤ªà¥à¤°à¤•à¤¾à¤°',
    income: 'à¤†à¤¯',
    expense: 'à¤µà¥à¤¯à¤¯',
    description: 'à¤µà¤¿à¤µà¤°à¤£',
    loanDetails: 'à¤‹à¤£ à¤µà¤¿à¤µà¤°à¤£',
    loanType: 'à¤ªà¥à¤°à¤•à¤¾à¤°',
    person: 'à¤µà¥à¤¯à¤•à¥à¤¤à¤¿',
    remaining: 'à¤¶à¥‡à¤·',
    status: 'à¤¸à¥à¤¥à¤¿à¤¤à¤¿',
    given: 'à¤¦à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾',
    taken: 'à¤²à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾',
    paid: 'à¤šà¥à¤•à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾',
    partial: 'à¤†à¤‚à¤¶à¤¿à¤•',
    pending: 'à¤²à¤‚à¤¬à¤¿à¤¤',
    scanQR: 'QR à¤¸à¥à¤•à¥ˆà¤¨ à¤•à¤°à¥‡à¤‚',
    visitWebsite: 'à¤µà¥‡à¤¬à¤¸à¤¾à¤‡à¤Ÿ à¤ªà¤° à¤œà¤¾à¤à¤‚',
    generatedBy: 'à¤®à¥à¤¸à¥à¤²à¤¿à¤® à¤«à¤¾à¤‡à¤¨à¥‡à¤‚à¤¸ à¤Ÿà¥à¤°à¥ˆà¤•à¤° à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤œà¤¨à¤°à¥‡à¤Ÿ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾',
    generatedOn: 'à¤¨à¤¿à¤°à¥à¤®à¤¾à¤£ à¤¤à¤¿à¤¥à¤¿ à¤”à¤° à¤¸à¤®à¤¯',
    copyright: 'Â© 2024 Muslim Programmer',
    rights: 'à¤¸à¤°à¥à¤µà¤¾à¤§à¤¿à¤•à¤¾à¤° à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤',
    website: 'muslim-finance-tracker.vercel.app'
  },
  ur: {
    title: 'Ù…Ø³Ù„Ù… ÙÙ†Ø§Ù†Ø³ Ù¹Ø±ÛŒÚ©Ø±',
    subtitle: 'Ø°Ø§ØªÛŒ Ù…Ø§Ù„ÛŒ Ø±Ù¾ÙˆØ±Ù¹',
    name: 'Ù†Ø§Ù…',
    email: 'Ø§ÛŒ Ù…ÛŒÙ„',
    reportDate: 'Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ ØªØ§Ø±ÛŒØ®',
    time: 'ÙˆÙ‚Øª',
    financialSummary: 'Ù…Ø§Ù„ÛŒ Ø®Ù„Ø§ØµÛ',
    category: 'Ø²Ù…Ø±Û',
    amount: 'Ø±Ù‚Ù… (BDT)',
    totalIncome: 'Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ',
    totalExpense: 'Ú©Ù„ Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
    currentBalance: 'Ù…ÙˆØ¬ÙˆØ¯Û Ø¨ÛŒÙ„Ù†Ø³',
    monthlyIncome: 'Ù…Ø§ÛØ§Ù†Û Ø¢Ù…Ø¯Ù†ÛŒ',
    monthlyExpense: 'Ù…Ø§ÛØ§Ù†Û Ø§Ø®Ø±Ø§Ø¬Ø§Øª',
    monthlySavings: 'Ù…Ø§ÛØ§Ù†Û Ø¨Ú†Øª',
    transactionHistory: 'Ù„ÛŒÙ† Ø¯ÛŒÙ† Ú©ÛŒ ØªØ§Ø±ÛŒØ® (Ø­Ø§Ù„ÛŒÛ 15)',
    date: 'ØªØ§Ø±ÛŒØ®',
    type: 'Ù‚Ø³Ù…',
    income: 'Ø¢Ù…Ø¯Ù†ÛŒ',
    expense: 'Ø®Ø±Ú†',
    description: 'ØªÙØµÛŒÙ„',
    loanDetails: 'Ù‚Ø±Ø¶ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª',
    loanType: 'Ù‚Ø³Ù…',
    person: 'Ø´Ø®Øµ',
    remaining: 'Ø¨Ø§Ù‚ÛŒ',
    status: 'Ø­Ø§Ù„Øª',
    given: 'Ø¯ÛŒÛ’ Ú¯Ø¦Û’',
    taken: 'Ù„ÛŒÛ’ Ú¯Ø¦Û’',
    paid: 'Ø§Ø¯Ø§ Ø´Ø¯Û',
    partial: 'Ø¬Ø²ÙˆÛŒ',
    pending: 'Ø²ÛŒØ± Ø§Ù„ØªÙˆØ§Ø¡',
    scanQR: 'QR Ø³Ú©ÛŒÙ† Ú©Ø±ÛŒÚº',
    visitWebsite: 'ÙˆÛŒØ¨ Ø³Ø§Ø¦Ù¹ ÙˆØ²Ù¹ Ú©Ø±ÛŒÚº',
    generatedBy: 'Ù…Ø³Ù„Ù… ÙÙ†Ø§Ù†Ø³ Ù¹Ø±ÛŒÚ©Ø± Ú©Û’ Ø°Ø±ÛŒØ¹Û’ ØªÛŒØ§Ø±',
    generatedOn: 'ØªÛŒØ§Ø±ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø§ÙˆØ± ÙˆÙ‚Øª',
    copyright: 'Â© 2024 Muslim Programmer',
    rights: 'ØªÙ…Ø§Ù… Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸',
    website: 'muslim-finance-tracker.vercel.app'
  }
};

const categoryTranslations = {
  en: {
    'à¦¬à§‡à¦¤à¦¨': 'Salary',
    'à¦¬à§à¦¯à¦¬à¦¸à¦¾': 'Business',
    'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚': 'Freelancing',
    'à¦–à¦¾à¦¬à¦¾à¦°': 'Food',
    'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤': 'Transport',
    'à¦¬à¦¿à¦²': 'Bills',
    'à¦¶à¦¿à¦•à§à¦·à¦¾': 'Education',
    'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯': 'Health',
    'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾': 'Charity',
    'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯': 'Other'
  },
  bn: {
    'à¦¬à§‡à¦¤à¦¨': 'à¦¬à§‡à¦¤à¦¨',
    'à¦¬à§à¦¯à¦¬à¦¸à¦¾': 'à¦¬à§à¦¯à¦¬à¦¸à¦¾',
    'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚': 'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚',
    'à¦–à¦¾à¦¬à¦¾à¦°': 'à¦–à¦¾à¦¬à¦¾à¦°',
    'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤': 'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤',
    'à¦¬à¦¿à¦²': 'à¦¬à¦¿à¦²',
    'à¦¶à¦¿à¦•à§à¦·à¦¾': 'à¦¶à¦¿à¦•à§à¦·à¦¾',
    'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯': 'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯',
    'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾': 'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾',
    'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯': 'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯'
  },
  ar: {
    'à¦¬à§‡à¦¤à¦¨': 'Ø§Ù„Ø±Ø§ØªØ¨',
    'à¦¬à§à¦¯à¦¬à¦¸à¦¾': 'Ø§Ù„Ø¹Ù…Ù„',
    'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚': 'Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø±',
    'à¦–à¦¾à¦¬à¦¾à¦°': 'Ø§Ù„Ø·Ø¹Ø§Ù…',
    'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤': 'Ø§Ù„Ù†Ù‚Ù„',
    'à¦¬à¦¿à¦²': 'Ø§Ù„ÙÙˆØ§ØªÙŠØ±',
    'à¦¶à¦¿à¦•à§à¦·à¦¾': 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…',
    'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯': 'Ø§Ù„ØµØ­Ø©',
    'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾': 'Ø§Ù„ØµØ¯Ù‚Ø©',
    'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯': 'Ø£Ø®Ø±Ù‰'
  },
  hi: {
    'à¦¬à§‡à¦¤à¦¨': 'à¤µà¥‡à¤¤à¤¨',
    'à¦¬à§à¦¯à¦¬à¦¸à¦¾': 'à¤µà¥à¤¯à¤µà¤¸à¤¾à¤¯',
    'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚': 'à¤«à¥à¤°à¥€à¤²à¤¾à¤‚à¤¸à¤¿à¤‚à¤—',
    'à¦–à¦¾à¦¬à¦¾à¦°': 'à¤­à¥‹à¤œà¤¨',
    'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤': 'à¤¯à¤¾à¤¤à¤¾à¤¯à¤¾à¤¤',
    'à¦¬à¦¿à¦²': 'à¤¬à¤¿à¤²',
    'à¦¶à¦¿à¦•à§à¦·à¦¾': 'à¤¶à¤¿à¤•à¥à¤·à¤¾',
    'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯': 'à¤¸à¥à¤µà¤¾à¤¸à¥à¤¥à¥à¤¯',
    'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾': 'à¤¦à¤¾à¤¨',
    'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯': 'à¤…à¤¨à¥à¤¯'
  },
  ur: {
    'à¦¬à§‡à¦¤à¦¨': 'ØªÙ†Ø®ÙˆØ§Û',
    'à¦¬à§à¦¯à¦¬à¦¸à¦¾': 'Ú©Ø§Ø±ÙˆØ¨Ø§Ø±',
    'à¦«à§à¦°à¦¿à¦²à§à¦¯à¦¾à¦¨à§à¦¸à¦¿à¦‚': 'ÙØ±ÛŒ Ù„Ø§Ù†Ø³Ù†Ú¯',
    'à¦–à¦¾à¦¬à¦¾à¦°': 'Ú©Ú¾Ø§Ù†Ø§',
    'à¦¯à¦¾à¦¤à¦¾à¦¯à¦¼à¦¾à¦¤': 'Ø¢Ù…Ø¯ÙˆØ±ÙØª',
    'à¦¬à¦¿à¦²': 'Ø¨Ù„',
    'à¦¶à¦¿à¦•à§à¦·à¦¾': 'ØªØ¹Ù„ÛŒÙ…',
    'à¦¸à§à¦¬à¦¾à¦¸à§à¦¥à§à¦¯': 'ØµØ­Øª',
    'à¦¦à¦¾à¦¨-à¦¸à¦¾à¦¦à¦¾à¦•à¦¾': 'Ø®ÛŒØ±Ø§Øª',
    'à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯': 'Ø¯ÛŒÚ¯Ø±'
  }
};

export const generateFinancialReport = async (userData, transactions, loans, stats, language = 'en') => {
  const t = translations[language] || translations.en;
  const categoryMap = categoryTranslations[language] || categoryTranslations.en;

  // Create temporary div
  const reportElement = document.createElement('div');
  reportElement.style.position = 'fixed';
  reportElement.style.left = '-10000px';
  reportElement.style.top = '0';
  reportElement.style.width = '800px';
  reportElement.style.padding = '30px';
  reportElement.style.backgroundColor = 'white';
  reportElement.style.fontFamily = "'Noto Sans Bengali', 'Noto Sans Arabic', 'Noto Sans Devanagari', 'Noto Nastaliq Urdu', 'Helvetica', 'Arial', sans-serif";
  reportElement.style.zIndex = '10000';
  reportElement.style.lineHeight = '1.5';

  const now = new Date();
  const dateStr = now.toLocaleDateString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  const timeStr = now.toLocaleTimeString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: language !== 'ar'
  });

  // âœ… Generate QR Code
  const qrCodeDataUrl = await QRCode.toDataURL('https://muslim-finance-tracker.vercel.app', {
    width: 500,
    margin: 2,
    errorCorrectionLevel: 'H',
    color: {
      dark: '#000000',
      light: '#FFFFFF'
    }
  });

  // âœ… Load Mosque SVG Icon (embedded as base64)
  const mosqueIconSvg = `data:image/svg+xml;base64,${btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="50" height="50">
      <circle cx="50" cy="50" r="45" fill="#22c55e"/>
      <text x="50" y="70" font-size="50" text-anchor="middle" fill="white">ðŸ•Œ</text>
    </svg>
  `)}`;

  // Build HTML content
  reportElement.innerHTML = `
    <div style="width: 100%; background: white; color: #333; font-size: 12px; line-height: 1.5;">
      <!-- Header -->
      <div style="display: flex; align-items: center; margin-bottom: 25px; border-bottom: 3px solid #22c55e; padding-bottom: 15px;">
        <!-- âœ… Mosque Icon -->
        <div style="margin-right: 15px;">
          <img src="${mosqueIconSvg}" style="width: 50px; height: 50px; display: block;" alt="Mosque" />
        </div>
        <div style="flex: 1;">
          <div style="font-size: 22px; font-weight: bold; color: #22c55e; margin-bottom: 5px;">
            ${t.title}
          </div>
          <div style="font-size: 14px; color: #666; font-weight: 500;">
            ${t.subtitle}
          </div>
        </div>
      </div>

      <!-- User Info -->
      <div style="margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
        <div>
          <div style="margin-bottom: 6px;">
            <strong>${t.name}:</strong> ${userData.name || 'User'}
          </div>
          <div>
            <strong>${t.email}:</strong> ${userData.email || ''}
          </div>
        </div>
        <div style="text-align: ${language === 'ar' || language === 'ur' ? 'left' : 'right'};">
          <div style="margin-bottom: 6px;">
            <strong>${t.reportDate}:</strong> ${dateStr}
          </div>
          <div>
            <strong>${t.time}:</strong> ${timeStr}
          </div>
        </div>
      </div>

      <!-- Financial Summary -->
      <div style="margin-bottom: 25px;">
        <h2 style="color: #22c55e; border-left: 4px solid #22c55e; padding-left: 12px; margin-bottom: 12px; font-size: 16px; font-weight: bold;">
          ${t.financialSummary}
        </h2>
        <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0;">
          <thead>
            <tr style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
              <th style="padding: 12px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-size: 11px; font-weight: 600;">
                ${t.category}
              </th>
              <th style="padding: 12px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-size: 11px; font-weight: 600;">
                ${t.amount}
              </th>
            </tr>
          </thead>
          <tbody>
            ${[
              { key: 'totalIncome', value: stats.totalIncome },
              { key: 'totalExpense', value: stats.totalExpense },
              { key: 'currentBalance', value: stats.balance },
              { key: 'monthlyIncome', value: stats.monthlyIncome },
              { key: 'monthlyExpense', value: stats.monthlyExpense },
              { key: 'monthlySavings', value: stats.monthlyIncome - stats.monthlyExpense }
            ].map((item, index) => `
              <tr style="${index % 2 === 0 ? 'background: #f8fafc;' : 'background: white;'}">
                <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle; font-size: 11px;">
                  ${t[item.key]}
                </td>
                <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle; font-weight: 600; font-size: 11px; color: ${item.key.includes('Expense') ? '#ef4444' : item.key.includes('Balance') || item.key.includes('Savings') ? '#22c55e' : '#333'};">
                  ${item.value.toLocaleString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US')}
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>

      <!-- Transactions -->
      ${transactions && transactions.length > 0 ? `
        <div style="margin-bottom: 25px;">
          <h2 style="color: #22c55e; border-left: 4px solid #22c55e; padding-left: 12px; margin-bottom: 12px; font-size: 16px; font-weight: bold;">
            ${t.transactionHistory}
          </h2>
          <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; font-size: 10px;">
            <thead>
              <tr style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white;">
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.date}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.type}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.category}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.amount}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.description}
                </th>
              </tr>
            </thead>
            <tbody>
              ${transactions.slice(0, 15).map((transaction, index) => {
                const translatedCategory = categoryMap[transaction.category] || transaction.category;
                return `
                  <tr style="${index % 2 === 0 ? 'background: #f8fafc;' : 'background: white;'}">
                    <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                      ${new Date(transaction.date).toLocaleDateString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US')}
                    </td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                      <span style="color: ${transaction.type === 'income' ? '#22c55e' : '#ef4444'}; font-weight: 600;">
                        ${transaction.type === 'income' ? t.income : t.expense}
                      </span>
                    </td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                      ${translatedCategory}
                    </td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle; font-weight: 600; color: ${transaction.type === 'income' ? '#22c55e' : '#ef4444'};">
                      ${transaction.amount.toLocaleString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US')}
                    </td>
                    <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                      ${transaction.description || '-'}
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      ` : ''}

      <!-- Loans -->
      ${loans && loans.length > 0 ? `
        <div style="margin-bottom: 30px;">
          <h2 style="color: #f97316; border-left: 4px solid #f97316; padding-left: 12px; margin-bottom: 12px; font-size: 16px; font-weight: bold;">
            ${t.loanDetails}
          </h2>
          <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; font-size: 10px;">
            <thead>
              <tr style="background: linear-gradient(135deg, #f97316, #ea580c); color: white;">
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.loanType}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.person}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.amount}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.remaining}
                </th>
                <th style="padding: 10px; text-align: center; vertical-align: middle; border: 1px solid #cbd5e0; font-weight: 600;">
                  ${t.status}
                </th>
              </tr>
            </thead>
            <tbody>
              ${loans.map((loan, index) => `
                <tr style="${index % 2 === 0 ? 'background: #f8fafc;' : 'background: white;'}">
                  <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                    <span style="color: ${loan.type === 'given' ? '#22c55e' : '#ef4444'}; font-weight: 600;">
                      ${loan.type === 'given' ? t.given : t.taken}
                    </span>
                  </td>
                  <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                    ${loan.personName}
                  </td>
                  <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle; font-weight: 600;">
                    ${loan.amount.toLocaleString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US')}
                  </td>
                  <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle; font-weight: 600; color: ${loan.remainingAmount > 0 ? '#ef4444' : '#22c55e'};">
                    ${loan.remainingAmount.toLocaleString(language === 'bn' ? 'bn-BD' : language === 'ar' ? 'ar-SA' : language === 'hi' ? 'hi-IN' : language === 'ur' ? 'ur-PK' : 'en-US')}
                  </td>
                  <td style="padding: 8px; border: 1px solid #e2e8f0; text-align: center; vertical-align: middle;">
                    <span style="color: ${loan.status === 'paid' ? '#22c55e' : loan.status === 'partial' ? '#f59e0b' : '#ef4444'}; font-weight: 600;">
                      ${loan.status === 'paid' ? t.paid : loan.status === 'partial' ? t.partial : t.pending}
                    </span>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      ` : ''}

      <!-- âœ… Footer with QR Code -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 50px; padding: 25px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 12px; border: 2px solid #22c55e;">
        
        <!-- Left: Generated Info -->
        <div style="flex: 1;">
          <div style="font-weight: 700; color: #166534; margin-bottom: 6px; font-size: 11px;">
            ${t.generatedBy}
          </div>
          <div style="color: #15803d; font-size: 10px; font-weight: 500; margin-bottom: 4px;">
            ${t.generatedOn}:
          </div>
          <div style="color: #15803d; font-size: 10px; font-weight: 600;">
            ${dateStr}
          </div>
          <div style="color: #15803d; font-size: 10px; font-weight: 600;">
            ${timeStr}
          </div>
        </div>

        <!-- âœ… Center: QR Code -->
        <div style="flex: 0 0 auto; text-align: center; margin: 0 25px;">
          <div style="background: white; padding: 15px; border-radius: 12px; display: inline-block; box-shadow: 0 8px 16px rgba(0,0,0,0.3); border: 4px solid #22c55e;">
            <img src="${qrCodeDataUrl}" style="width: 100px; height: 100px; display: block;" alt="QR Code" />
          </div>
          <div style="margin-top: 10px;">
            <div style="font-weight: 700; color: #166534; font-size: 10px; margin-bottom: 3px;">
              ${t.scanQR}
            </div>
            <div style="color: #22c55e; font-weight: 700; font-size: 10px; text-decoration: underline;">
              ${t.website}
            </div>
          </div>
        </div>

        <!-- Right: Copyright -->
        <div style="flex: 1; text-align: right;">
          <div style="color: #15803d; font-size: 10px; font-weight: 600;">
            ${t.copyright}
          </div>
          <div style="color: #22c55e; font-size: 9px; font-weight: 500;">
            ${t.rights}
          </div>
        </div>
      </div>

    </div>
  `;

  // Add to document
  document.body.appendChild(reportElement);

  try {
    // âœ… Wait for fonts and images to load
    await new Promise(resolve => setTimeout(resolve, 1200));

    // âœ… Convert HTML to canvas with MAXIMUM quality
    const canvas = await html2canvas(reportElement, {
      scale: 3,
      useCORS: true,
      allowTaint: true,
      logging: false,
      width: 800,
      height: reportElement.scrollHeight,
      windowWidth: 800,
      backgroundColor: '#ffffff',
      imageTimeout: 0,
      foreignObjectRendering: false
    });

    // Remove temporary element
    document.body.removeChild(reportElement);

    // Create PDF
    const pdf = new jsPDF('p', 'mm', 'a4');
    const imgWidth = 210;
    const pageHeight = 297;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    // âœ… Smart page handling
    if (imgHeight <= pageHeight - 10) {
      pdf.addImage(canvas, 'PNG', 0, 0, imgWidth, imgHeight, '', 'FAST');
    } else {
      let position = 0;
      pdf.addImage(canvas, 'PNG', 0, position, imgWidth, imgHeight, '', 'FAST');
      
      let heightLeft = imgHeight - pageHeight;
      
      while (heightLeft > 30) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(canvas, 'PNG', 0, position, imgWidth, imgHeight, '', 'FAST');
        heightLeft -= pageHeight;
      }
    }

    return pdf;

  } catch (error) {
    if (document.body.contains(reportElement)) {
      document.body.removeChild(reportElement);
    }
    throw error;
  }
};
